<!DOCTYPE HTML>
<html lang="en-us">
<head>
  <meta charset="UTF-8">
  <title>MySql操作之表篇 - Dreamcatcher</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
  
  <meta name="description" content="一些基本的操作">
  
  <meta itemprop="name" content="MySql操作之表篇 - Dreamcatcher">
  <meta itemprop="description" content="一些基本的操作">
  
  <meta itemprop="image" content="https://lpgph.github.io/img/author.jpg">

  
  
  <meta name="twitter:description" content="曾梦想仗剑走天涯">
  
  
  <link rel="shortcut icon" href="https://lpgph.github.io/img/favicon.ico"/>
  <link rel="apple-touch-icon" href="https://lpgph.github.io/img/apple-touch-icon.png" />
  <link rel="apple-touch-icon-precomposed" href="https://lpgph.github.io/img/apple-touch-icon.png" />

  
  
  <link rel="stylesheet" href="https://lpgph.github.io/font/hack/css/hack.min.css">
  <link rel="stylesheet" href="https://lpgph.github.io/font/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://lpgph.github.io/font/playball/playball.css">

  <link rel="stylesheet" href="https://lpgph.github.io/css/style.css">	

  <script src="https://lpgph.github.io/plugin/live2d-widget/js/L2Dwidget.min.js"></script>
  <script src="https://lpgph.github.io/js/spring-loaders.js"></script>
  
  
  <link rel="stylesheet" href="https://lpgph.github.io/plugin/highlight/styles/github.css">
  <script src="https://lpgph.github.io/plugin/highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  <script src="https://lpgph.github.io/js/jquery-3.3.1.min.js"></script>
  
  <script type="text/javascript" src="/js/click_show_text.js"></script>
  
  <script src="https://lpgph.github.io/js/motto-show.js"></script>

</head>
<body>
  <div id="home" class="app-home">
    <div>
      <button class="navbutton"  id="openaside" title="显示侧边栏">
  <i class="fa fa-navicon"></i>  
  <span id="nav-btn-title" style="padding-left: 10px;">MENU</span>
</button>
<div id="asidepart" class="asidepart">
  <button class="close-button"  id="closeaside" title="隐藏侧边栏">
    <i class="fa fa-close"></i>
  </button>
  <div class="aside-info">
    <div class="blog-info">
  
  <div class="blog-avatar">
    <a href="https://lpgph.github.io/">
      <img src="https://lpgph.github.io/img/avatar.jpg" alt="lpgph" title="lpgph"/>
    </a>
  </div>
  
  <div class="blog-author-info">
    <h1 class="blog-author"><a href="https://lpgph.github.io/" title="lpgph">lpgph</a></h1>
    <h2 class="blog-motto" id="blog-motto"></h2>

    <script>
     
      binft(document.getElementById('blog-motto'),["青青陵上柏，磊磊涧中石","人生天地间，忽如远行客","斗酒相娱乐，聊厚不为薄","驱车策驽马，游戏宛与洛","洛中何郁郁，冠带自相索","长衢罗夹巷，王侯多第宅","两宫遥相望，双阙百余尺","极宴娱心意，戚戚何所迫？"]);
    
    </script>
  </div>
  <nav class="animated">
    <ul>
      
      <li><a href="/">主页</a></li>
      
      <li><a href="/post/">归档</a></li>
      
      <li><a href="/tags/">标签云</a></li>
      
      <li><a href="/categories/learn/">笔记</a></li>
      
      <li><a href="/categories/notes/">记录</a></li>
      
      <li><a href="/categories/booklist/">书单</a></li>
      
      <li><a href="/about/">关于我</a></li>
      
    </ul>
    <h1 class="asidetitle">搜索</h1>
    <form class="search" method="get" action="https://www.google.com/search">
        <input type="text" id="search" name="q" placeholder="搜索">
    </form>
  </nav>
</div>
    

<div class="categorieslist">
  <h1 class="asidetitle">分类</h1>
  <ul class="side-info-list">
    
    <li><a href="https://lpgph.github.io/categories/java" title="java">java<sup>(1)</sup></a></li>
    
    <li><a href="https://lpgph.github.io/categories/mysql" title="mysql">mysql<sup>(6)</sup></a></li>
    
    <li><a href="https://lpgph.github.io/categories/%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f" title="设计模式">设计模式<sup>(1)</sup></a></li>
    
  </ul>
</div>



    

<div class="tagslist">
	<h1 class="asidetitle">标签</h1>
	<ul class="side-info-list">
		
		<li><a href="https://lpgph.github.io/tags/java" title="java">java<sup>(2)</sup></a></li>
		
		<li><a href="https://lpgph.github.io/tags/mysql" title="mysql">mysql<sup>(6)</sup></a></li>
		
		<li><a href="https://lpgph.github.io/tags/quartz" title="quartz">quartz<sup>(1)</sup></a></li>
		
		<li><a href="https://lpgph.github.io/tags/spring" title="spring">spring<sup>(1)</sup></a></li>
		
		<li><a href="https://lpgph.github.io/tags/%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f" title="设计模式">设计模式<sup>(1)</sup></a></li>
		
	</ul>
</div>


    

  <div class="social-list">
  	<h1 class="asidetitle">社交</h1>
    <div class="social-info">
      
      
      
        <a href="https://github.com/lpgph" target="_blank" title="github"></a>
      
      
      
    </div>
  </div>
  

  </div>
</div>
<div id="sideBar" class="app-menu"></div>
    </div>
    <header class="app-header article-header" id="app-header">
      
<div class="vertical">
  <div class="inner">
      <h1 itemprop="name" class="article-title">
        <a href="https://lpgph.github.io/post/mysql_table/" title="MySql操作之表篇" itemprop="url">MySql操作之表篇</a>
      </h1>
      <h2 class="article-info">
        <p class="article-info-text">
          Posted by
          
            <a href="http://localhost:1313/" title="lpgph">lpgph</a>
          
          on <time datetime="2018-03-03 13:37:02 &#43;0000 UTC" itemprop="datePublished">2018-03-03</time>
        </p>

        
        
          
          <span class="article-tag  article-category-color">
            <a href="https://lpgph.github.io/categories/mysql">MySql</a>
          </span>
          
        
        

        
        
          
          <span class="article-tag  article-tag-color">
            <a href="https://lpgph.github.io/tags/mysql">MySql</a>
          </span>
          
        
        



      </h2>
  </div>
</div>
    </header>

    <div id="container"  class="app container">
      
       <div id="main" class="post"> 

        
	<article class="article-content">
    <p>一些基本的操作</p>

<p><a href="https://dev.mysql.com/doc/refman/5.7/en/select.html" title="Mysql官方文档">Mysql官方文档</a></p>

<h2 id="创建和删除">创建和删除</h2>

<pre><code class="language-sql">//创建表
mysql&gt; create table &lt;table_name&gt;(field[,field2,...]) comment='';
//eg:
mysql&gt; create table user(
&gt; id int(4) not null primary key auto_increment,
&gt; name varchar(20) not null,
&gt; sex int(1) not null default '0',
&gt; weight double(10,2)) comment='用户表';
</code></pre>

<pre><code class="language-sql">//删除表
mysql&gt; drop table &lt;table_name&gt;;
</code></pre>

<pre><code class="language-sql">//修改表名
mysql&gt; rename table &lt;old_table_name&gt; to &lt;new_table_name&gt;;
</code></pre>

<h2 id="查看表">查看表</h2>

<pre><code class="language-sql">SHOW DATABASES                                //列出 MySQL Server 数据库。
SHOW TABLES [FROM db_name]                    //列出数据库数据表。
SHOW TABLE STATUS [FROM db_name]              //列出数据表及表状态信息。
SHOW COLUMNS FROM tbl_name [FROM db_name]     //列出资料表字段
SHOW FIELDS FROM tbl_name [FROM db_name]
DESCRIBE tbl_name [col_name]                  //可以简写为： DESC tbl_name [col_name]
SHOW FULL COLUMNS FROM tbl_name [FROM db_name]//列出字段及详情
SHOW FULL FIELDS FROM tbl_name [FROM db_name] //列出字段完整属性
SHOW INDEX FROM tbl_name [FROM db_name]       //列出表索引。
SHOW STATUS                                  //列出 DB Server 状态。
SHOW VARIABLES                               //列出 MySQL 系统环境变量。
SHOW PROCESSLIST                             //列出执行命令。
SHOW GRANTS FOR user                         //列出某用户权限
</code></pre>

<h2 id="表字段">表字段</h2>

<h3 id="常用字段属性">常用字段属性:</h3>

<table>
<thead>
<tr>
<th>属性</th>
<th>含义</th>
</tr>
</thead>

<tbody>
<tr>
<td>auto_increment</td>
<td>为新插入的行赋一个唯一的整数标识符,自动递增,作为主键列，每个表只允许有一个自动递增列</td>
</tr>

<tr>
<td>binary</td>
<td>区分大小写的方式排序</td>
</tr>

<tr>
<td>default</td>
<td>属性确保在没有任何值可用的情况下，赋予某个常量值，这个值必须是常量，因为MySQL不允许插入函数或表达式值。此外，此属性无法用于BLOB或TEXT列。如果已经为此列指定了NULL属性，没有指定默认值时默认值将为NULL，否则默认值将依赖于字段的数据类型</td>
</tr>

<tr>
<td>index</td>
<td>如果所有其他因素都相同，要加速数据库查询，使用索引通常是最重要的一个步骤。索引一个列会为该列创建一个有序的键数组，每个键指向其相应的表行。以后针对输入条件可以搜索这个有序的键数组，与搜索整个未索引的表相比，这将在性能方面得到极大的提升。<strong>在实践中尽量使用小的索引。</strong></td>
</tr>

<tr>
<td>not null</td>
<td>如果将一个列定义为not null，将不允许向该列插入null值。<strong>建议在重要情况下始终使用not null属性</strong>，因为它提供了一个基本验证，确保已经向查询传递了所有必要的值。</td>
</tr>

<tr>
<td>null</td>
<td>为列指定null属性时，该列可以保持为空，而不论行中其它列是否已经被填充。记住，<strong>null精确的说法是“无”，而不是空字符串或0。</strong></td>
</tr>

<tr>
<td>primary key</td>
<td>用于确保指定行的唯一性。指定为主键的列中，值不能重复，也不能为空。为指定为主键的列赋予auto_increment属性是很常见的，因为此列不必与行数据有任何关系，而只是作为一个唯一标识符。作为主键又分两种：<br>(1) 单字段主键 如果输入到数据库中的每行都已经有不可修改的唯一标识符，一般会使用单字段主键。注意，此主键一旦设置就不能再修改。<br>(2) 多字段主键如果记录中任何一个字段都不可能保证唯一性，就可以使用多字段主键。这时，多个字段联合起来确保唯一性。如果出现这种情况，指定一个auto_increment整数作为主键是更好的办法。</td>
</tr>

<tr>
<td>unique</td>
<td>被赋予unique属性的列将确保所有值都有不同的值，只是null值可以重复。一般会指定一个列为unique，以确保该列的所有值都不同。</td>
</tr>

<tr>
<td>zerofill</td>
<td>可用于任何数值类型，用0填充所有剩余字段空间。例如，无符号int的默认宽度是10；因此，当“零填充”的int值为4时，将表示它为0000000004。</td>
</tr>

<tr>
<td>character set</td>
<td>指定一个字符集</td>
</tr>
</tbody>
</table>

<h3 id="添加字段">添加字段</h3>

<pre><code class="language-sql">mysql&gt; alter table &lt;table_name&gt; add &lt;field_name&gt; &lt;field_type&gt; comment &quot;备注&quot;;
//eg:在表user添加了一个字段update_time，类型为timestamp，设置创建时间和默认时间
mysql&gt; alter table user add update_time timestamp default CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP comment='更新时间';
// 在log表中 添加一个state字段并且放在current_count后
mysql&gt; ALTER TABLE log ADD `state` TINYINT (1) UNSIGNED NOT NULL DEFAULT 0 COMMENT &quot;状态，0 待审核，1已审核，2拒绝&quot; AFTER current_count;
</code></pre>

<h3 id="修改字段">修改字段</h3>

<pre><code class="language-sql">mysql&gt; alter table &lt;table_name&gt; change &lt;old_table&gt; &lt;new_table&gt; &lt;field_type&gt;;
//eg:
mysql&gt; alter table user change weight height double(8,2);
</code></pre>

<h3 id="删除字段">删除字段</h3>

<pre><code class="language-sql">删除字段：
mysql&gt; alter table &lt;table_name&gt; drop &lt;field_name&gt;;
</code></pre>

<h3 id="添加索引">添加索引</h3>

<pre><code class="language-sql">//一般索引
mysql&gt; alter table &lt;table_name&gt; add index &lt;index_name&gt; (field_name[,field_name2,...]);
//eg:
mysql&gt; alter table user add index u_name (name,sex);
</code></pre>

<pre><code class="language-sql">//加主关键字的索引
mysql&gt; alter table &lt;table_name&gt; add primary key &lt;field_name&gt;;
//eg:
mysql&gt; alter table user add primary key(id);
</code></pre>

<pre><code class="language-sql">//加唯一限制条件的索引
mysql&gt; alter table &lt;table_name&gt; add unique &lt;index_name&gt; (field_name);
//eg:
mysql&gt; alter table user add unique u_name(cardnumber);
</code></pre>

<h3 id="删除索引">删除索引</h3>

<pre><code class="language-sql">mysql&gt; alter table &lt;table_name&gt; drop index &lt;index_name&gt;;
//eg:
mysql&gt; alter table user drop index u_name;
</code></pre>

<h2 id="insert语法">insert语法</h2>

<pre><code class="language-sql">INSERT [ LOW_PRIORITY | DELAYED | HIGH_PRIORITY ] [ IGNORE ] [ INTO ] tbl_name [ PARTITION (
	partition_name ,...) ] [ (
		col_name ,...) ] {
		VALUES
			|
		VALUE
			} ({ expr | DEFAULT },...),(...) ,...[ ON DUPLICATE KEY UPDATE col_name = expr [, col_name = expr ]...]

//eg1 单条插入:
mysql&gt; INSERT INTO user(name, age) VALUE (&quot;张三&quot;,18);
//eg2 多条插入:
mysql&gt; INSERT INTO user(name, age) VALUES (&quot;张三&quot;,18),(&quot;李四&quot;,19),(&quot;王五&quot;,20);
</code></pre>

<p>or</p>

<pre><code class="language-sql">//只能插入一条
INSERT [ LOW_PRIORITY | DELAYED | HIGH_PRIORITY ] [ IGNORE ] [ INTO ] tbl_name [ PARTITION (
	partition_name ,...) ]
	SET col_name ={ expr | DEFAULT },...[ ON DUPLICATE KEY UPDATE col_name = expr [, col_name = expr ]...]

//eg:
mysql&gt; INSERT INTO user set name=&quot;张三&quot;, age=18;
</code></pre>

<p>or</p>

<pre><code class="language-sql">//用于表复制
INSERT [ LOW_PRIORITY | HIGH_PRIORITY ] [ IGNORE ] [ INTO ] tbl_name [ PARTITION (
	partition_name ,...) ] [ (
		col_name ,...) ] SELECT
			...[ ON DUPLICATE KEY UPDATE col_name = expr [, col_name = expr ]...]
			
//eg1 两个表数据互通:
mysql&gt; INSERT INTO a(a_field1,a_field2) SELECT b_field1,b_field2 FROM b;
//eg2 多张表进行复制,需要先使用关联查询查出数据后再插入,嵌套部分需要设置别名！！:
mysql&gt; INSERT INTO a(a_field1,a_field2) SELECT * FROM(SELECT f1,f2 FROM b JOIN c) AS tb;
</code></pre>

<h2 id="update语法">update语法</h2>

<h3 id="单条更新">单条更新：</h3>

<pre><code class="language-sql">UPDATE [ LOW_PRIORITY ] [ IGNORE ] table_reference
SET col_name1 ={ expr1 | DEFAULT } [, col_name2 ={ expr2 | DEFAULT }]...[
WHERE
	where_condition ] [
ORDER BY
	...] [
LIMIT row_count ]

# eg1 单表更新:
UPDATE user SET name=&quot;李四&quot;,age=19 WHERE id=1;

# eg2 多表更新:
UPDATE USER u
INNER JOIN user_info ui ON u.user_id = ui_user_id
SET ui_age = 20
WHERE
	u.sex = 1;
</code></pre>

<h3 id="多条更新">多条更新：</h3>

<p>由于mysql并没有提供多条更新语句，所以进行批量更新网上有三种方法：
1. 在程序中批量update，一条记录update一次，性能很差
2. 使用replace into 或者insert into &hellip;on duplicate key update，性能较好
    <code>sql
    //eg1：replace into (操作本质是对重复的记录先delete后insert，如果更新的字段不全会将缺失的字段置为缺省值)
    mysql&gt; replace into user (name,age) values (&quot;张三&quot;,15),(&quot;李四&quot;,20),(&quot;王五&quot;,17);
    //eg2：insert into (操作本质是只update重复记录，不会改变其它字段。)
    mysql&gt; insert into user (id, name, age) values (1,&quot;张三&quot;,15),(2,&quot;李四&quot;,20),(3,&quot;王五&quot;,17) on duplicate key update name=values(name), age=values(age);
</code>
    <a href="http://www.itpub.net/forum.php?mod=viewthread&amp;tid=1770206" title="原文地址">两者异同</a>
    相同之处:
    &gt;(1) 没有key的时候，replace与insert .. on deplicate udpate相同。
    (2) 有key的时候，都保留主键值，并且auto_increment自动+1</p>

<pre><code>不同之处：
&gt;有key的时候，replace是delete老记录，而录入新的记录，所以原有的所有记录会被清除，这个时候，如果replace语句的字段不全的话，有些原有的字段的值会被自动填充为默认值。
而insert .. duplicate update则只执行update标记之后的sql，从表象上来看相当于一个简单的update语句。所以两者的区别只有一个，insert .. on duplicate udpate保留了所有字段的旧值，再覆盖然后一起insert进去，而replace没有保留旧值，直接删除再insert新值。

从底层执行效率上来讲，replace要比insert .. on duplicate update效率要高，但是在写replace的时候，字段要写全，防止老的字段数据被删除。
</code></pre>

<ol>
<li><p>创建临时表，先更新临时表，然后从临时表中update，性能最好</p>

<pre><code class="language-sql">//注意：这种方法需要用户有temporary 表的create 权限。
mysql&gt; create temporary table tmp(id int(4) primary key,name varchar(50), age int(4));
mysql&gt; insert into tmp values (1,&quot;张三&quot;,15),(2,&quot;李四&quot;,20),(3,&quot;王五&quot;,17);
mysql&gt; update user, tmp set user.name=tmp.name, user.age=tmp.age where user.id=tmp.id;
</code></pre></li>
</ol>

<p>补充：</p>

<pre><code>// 批量替换字段内容的一部分
mysql&gt; UPDATE article SET content = REPLACE(content, 'abc', '123');
//效果： &quot;AabcB&quot; =》&quot;A123B&quot;
</code></pre>

<h2 id="delete语法">delete语法</h2>

<h3 id="普通删除">普通删除：</h3>

<pre><code class="language-sql">DELETE [ LOW_PRIORITY ] [ QUICK ] [ IGNORE ]
FROM
	tbl_name [ PARTITION (
		partition_name ,...) ] [
		WHERE
			where_condition ] [
		ORDER BY
			...] [
		LIMIT row_count ]

//eg1 删除单条:
mysql&gt; DELETE FROM user where user_id = 1;
//eg2 删除多条:
mysql&gt; DELETE FROM user where user_id in (1,2,3,4);
</code></pre>

<h3 id="多表删除">多表删除：</h3>

<pre><code class="language-sql">DELETE [ LOW_PRIORITY ] [ QUICK ] [ IGNORE ] tbl_name [.*] [, tbl_name [.*]]...
FROM
	table_references [
WHERE
	where_condition ]

//eg:
DELETE t1,t2
FROM t1
INNER JOIN t2
INNER JOIN t3
WHERE
	t1.id = t2.id
AND t2.id = t3.id;
</code></pre>

<p>or:</p>

<pre><code class="language-sql">DELETE [ LOW_PRIORITY ] [ QUICK ] [ IGNORE ]
FROM
	tbl_name [.*] [, tbl_name [.*]]... USING table_references [
WHERE
	where_condition ]
	
# eg：
DELETE
FROM
	t1,
	t2 USING t1
INNER JOIN t2
INNER JOIN t3
WHERE
	t1.id = t2.id
AND t2.id = t3.id;
</code></pre>

<h3 id="截断表">截断表：</h3>

<pre><code class="language-sql">mysql&gt; truncate table &lt;table_name&gt;;
/*
截断表可以用于删除表中的所有数据。截断表命令还会回收所有索引的分配页。截断表的执行速度与不带where子句的delete（删除）命令相同，甚至比它还要快。delete（删除）一次删除一行数据，并且将每一行被删除的数据都作为一个事务记录日志；而truncate （截断）表则回收整个数据页，只记录很少的日志项。delete（删除）和truncate（截断）都会回收被数据占用的空间，以及相关的索引。只有表的拥有者可以截断表。
另外，truncate表之后，如果有自动主键的话，会恢复成默认值。
*/
</code></pre>

<h2 id="select语法">select语法</h2>

<h3 id="基本语法">基本语法：</h3>

<pre><code class="language-sql">SELECT
	[ ALL | DISTINCT | DISTINCTROW ] [ HIGH_PRIORITY ] [ STRAIGHT_JOIN ] [ SQL_SMALL_RESULT ] [ SQL_BIG_RESULT ] [ SQL_BUFFER_RESULT ] [ SQL_CACHE | SQL_NO_CACHE ] [ SQL_CALC_FOUND_ROWS ] select_expr [, select_expr...] [
FROM
	table_references [ PARTITION partition_list ] [
WHERE
	where_condition ] [
GROUP BY
	{ col_name | expr | position } [ ASC | DESC ],...[ WITH ROLLUP ]] [
HAVING
	where_condition ] [
ORDER BY
	{ col_name | expr | position } [ ASC | DESC ],...] [
LIMIT {[ OFFSET ,] row_count | row_count OFFSET OFFSET }] [ PROCEDURE procedure_name (argument_list) ] [ INTO OUTFILE 'file_name' [ CHARACTER
SET charset_name ] export_options | INTO DUMPFILE 'file_name' | INTO var_name [, var_name ]] [ FOR UPDATE | LOCK IN SHARE MODE ]]

#eg:
#查询总条数
mysql&gt; SELECT COUNT(*) FROM test_table WHERE tf_b = 1;
#倒序分页查询
mysql&gt; SELECT tf_a, tf_b FROM test_table WHERE tf_b = 1 ORDER BY tf_a DESC LIMIT 100,10;
</code></pre>

<h3 id="花式操作">花式操作</h3>

<pre><code># 创建学生表1
CREATE TABLE `student1` (
  `STUDENT_ID` int(11) NOT NULL AUTO_INCREMENT COMMENT '学生自增长ID',
  `STUDENT_NAME` varchar(30) DEFAULT NULL COMMENT '学生名称',
  `STUDENT_COURSE` varchar(30) DEFAULT NULL COMMENT '学科',
  `STUDENT_SCORE` int(11) DEFAULT NULL COMMENT '成绩',
  PRIMARY KEY (`STUDENT_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='学生表';

# 插入数据
INSERT INTO student1 (
	STUDENT_NAME,
	STUDENT_COURSE,
	STUDENT_SCORE
)
VALUES
	(&quot;张三&quot;, &quot;语文&quot;, 80),
	(&quot;张三&quot;, &quot;数学&quot;, 90),
	(&quot;张三&quot;, &quot;英语&quot;, 85),
	(&quot;李四&quot;, &quot;语文&quot;, 30),
	(&quot;李四&quot;, &quot;数学&quot;, 90),
	(&quot;李四&quot;, &quot;英语&quot;, 100);
</code></pre>

<table>
<thead>
<tr>
<th align="right">STUDENT_ID</th>
<th align="right">STUDENT_NAME</th>
<th align="right">STUDENT_COURSE</th>
<th align="right">STUDENT_SCORE</th>
</tr>
</thead>

<tbody>
<tr>
<td align="right">1</td>
<td align="right">张三</td>
<td align="right">语文</td>
<td align="right">80</td>
</tr>

<tr>
<td align="right">2</td>
<td align="right">张三</td>
<td align="right">数学</td>
<td align="right">90</td>
</tr>

<tr>
<td align="right">3</td>
<td align="right">张三</td>
<td align="right">英语</td>
<td align="right">85</td>
</tr>

<tr>
<td align="right">4</td>
<td align="right">李四</td>
<td align="right">语文</td>
<td align="right">30</td>
</tr>

<tr>
<td align="right">5</td>
<td align="right">李四</td>
<td align="right">数学</td>
<td align="right">90</td>
</tr>

<tr>
<td align="right">6</td>
<td align="right">李四</td>
<td align="right">英语</td>
<td align="right">100</td>
</tr>
</tbody>
</table>

<pre><code># 创建学生表2
CREATE TABLE `student2` (
  `STUDENT_ID` int(11) NOT NULL AUTO_INCREMENT COMMENT '学生自增长ID',
  `STUDENT_NAME` varchar(30) DEFAULT NULL COMMENT '学生名称',
  `STUDENT_TOTAL_SCORE` int(1) DEFAULT NULL COMMENT '总成绩',
  PRIMARY KEY (`STUDENT_ID`)
) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT='学生总成绩';
</code></pre>

<h4 id="查询并插入">查询并插入</h4>

<p>语法格式</p>

<pre><code class="language-sql">INSERT INTO 表名1(字段列表1) SELECT 字段列表2 FROM 表名2 WHERE 条件表达式;
</code></pre>

<pre><code class="language-sql"># eg 用一条语句查询出student1表中学生总成绩并且降序插入student2表中
INSERT INTO student2 (
	STUDENT_NAME,
	STUDENT_TOTAL_SCORE
) SELECT
	STUDENT_NAME,
	SUM(STUDENT_SCORE) AS STUDENT_TOTAL_SCORE
FROM
	student1
GROUP BY
	STUDENT_NAME
</code></pre>

<p>运行结果：</p>

<table>
<thead>
<tr>
<th align="right">STUDENT_ID</th>
<th align="right">STUDENT_NAME</th>
<th align="right">STUDENT_TOTAL_SCORE</th>
</tr>
</thead>

<tbody>
<tr>
<td align="right">1</td>
<td align="right">张三</td>
<td align="right">255</td>
</tr>

<tr>
<td align="right">2</td>
<td align="right">李四</td>
<td align="right">220</td>
</tr>
</tbody>
</table>

<h4 id="查询并更新">查询并更新</h4>

<p>update时，更新的表不能在set和where中用于子查询,但是可以对多个表进行更新(INNER JOIN)，所以根据这个特性我们来做查询并更新
语法格式：</p>

<pre><code class="language-sql">UPDATE table1 a INNER JOIN table2 b on a.id = b.id set ... where ...
</code></pre>

<pre><code class="language-sql"># eg: 用一条语句将所有人的语文成绩改成95
UPDATE student1 a
INNER JOIN (
	SELECT
		STUDENT_ID,
		STUDENT_NAME,
		STUDENT_COURSE,
		STUDENT_SCORE
	FROM
		student1
	WHERE
		STUDENT_COURSE LIKE '%英语%'
) b ON a.STUDENT_ID = b.STUDENT_ID
SET a.STUDENT_SCORE = 95
</code></pre>

<h4 id="查询并删除">查询并删除</h4>

<p>通常查询并删除针对的是表中的重复记录，所以我们首先要查找到重复的记录：</p>

<h5 id="查找记录">查找记录</h5>

<pre><code class="language-sql">方法一(推荐)：
SELECT * FROM
	table a
WHERE
	[(a.field1,a.field2,...)] IN (
		SELECT
			[field1,field2,...]
		FROM
			table
		GROUP BY
			[field1 ,field2,...]
		HAVING
			Count(*) &gt; 1
	) 
方法二：
SELECT * FROM
	table a
WHERE
((  SELECT
    	COUNT(*)
    FROM
    	table
    WHERE
    	field1 = a.field1
        AND field2 = a.field2
        AND ...
)&gt; 1)
</code></pre>

<p>eg： ps. 如果需要只显示一条最新记录，则添加a.STUDENT_ID和MAX(STUDENT_ID)。</p>

<pre><code class="language-sql"># 根据多个字段查询student1
SELECT
	STUDENT_ID,
	STUDENT_NAME,
	STUDENT_COURSE,
	STUDENT_SCORE
FROM
	student1 a
WHERE
	(a.STUDENT_NAME, a.STUDENT_COURSE) IN (
	# (a.STUDENT_NAME, a.STUDENT_COURSE,a.STUDENT_ID) IN (
		SELECT
		    # MAX(STUDENT_ID)
			STUDENT_NAME,
			STUDENT_COURSE
		FROM
			student1
		GROUP BY
			STUDENT_NAME,
			STUDENT_COURSE
		HAVING
			count(*) &gt; 1
	)
ORDER BY
	STUDENT_COURSE DESC
</code></pre>

<h5 id="删除记录">删除记录</h5>

<p>如上所提，可以得到最新的一条数据，那只保留id最大的一条数据:
两种方法目前手头没有大的数据无法做测试，等以后再比较性能差异。
方法一：</p>

<pre><code class="language-sql">DELETE FROM student1
WHERE
    # 将最后插入的数据保留 其他数据删除
	STUDENT_ID  NOT IN (
 		# 查询最后插入的数据
		SELECT
			MAX(STUDENT_ID)
		FROM
			(
				#  查询出重复数据
				SELECT
					STUDENT_ID,
					STUDENT_NAME,
					STUDENT_COURSE,
					STUDENT_SCORE
				FROM
					student1 a
				WHERE
					(
						a.STUDENT_NAME,
						a.STUDENT_COURSE
					) IN (
						SELECT
							STUDENT_NAME,
							STUDENT_COURSE
						FROM
							student1
						GROUP BY
							STUDENT_NAME,
							STUDENT_COURSE
						HAVING
							count(*) &gt; 1
					)
			) AS tmp
		GROUP BY
			STUDENT_NAME,
			STUDENT_COURSE
		HAVING
			count(*) &gt; 1
	)
</code></pre>

<p>方法二：</p>

<pre><code class="language-sql">DELETE
FROM
	student1
WHERE
    #查出重复数据
	(
		STUDENT_NAME,
		STUDENT_COURSE
	) IN (
		SELECT
			STUDENT_NAME,
			STUDENT_COURSE
		FROM
			(
				SELECT
					STUDENT_NAME,
					STUDENT_COURSE
				FROM
					student1
				GROUP BY
					STUDENT_NAME,
					STUDENT_COURSE
				HAVING
					COUNT(*) &gt; 1
			) s1
	)
# 排除最后插入的数据保留
AND STUDENT_ID NOT IN (
	SELECT
		STUDENT_ID
	FROM
		(
			SELECT
				MAX(STUDENT_ID)
			FROM
				student1
			GROUP BY
				STUDENT_NAME,
				STUDENT_COURSE
			HAVING
				COUNT(*) &gt; 1
		) s2
);
</code></pre>
  </article>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>
<script>
var gitalk = new Gitalk({
  clientID: '86c61da5bfaea99e9f10',
  clientSecret: '3c0524cd32fbe175601f5b964c6a34b6d31b0975',
  repo: 'lpgph.github.io',
  owner: 'lpgph',
  admin: ['lpgph'],
  id: window.location.pathname,      
  distractionFreeMode: true  
})
gitalk.render('gitalk-container')
</script>


        <div class="article-toc-panel">
          <div class="article-toc" id="article-toc">
            <strong class="toc-title">文章目录</strong>
            <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#创建和删除">创建和删除</a></li>
<li><a href="#查看表">查看表</a></li>
<li><a href="#表字段">表字段</a>
<ul>
<li><a href="#常用字段属性">常用字段属性:</a></li>
<li><a href="#添加字段">添加字段</a></li>
<li><a href="#修改字段">修改字段</a></li>
<li><a href="#删除字段">删除字段</a></li>
<li><a href="#添加索引">添加索引</a></li>
<li><a href="#删除索引">删除索引</a></li>
</ul></li>
<li><a href="#insert语法">insert语法</a></li>
<li><a href="#update语法">update语法</a>
<ul>
<li><a href="#单条更新">单条更新：</a></li>
<li><a href="#多条更新">多条更新：</a></li>
</ul></li>
<li><a href="#delete语法">delete语法</a>
<ul>
<li><a href="#普通删除">普通删除：</a></li>
<li><a href="#多表删除">多表删除：</a></li>
<li><a href="#截断表">截断表：</a></li>
</ul></li>
<li><a href="#select语法">select语法</a>
<ul>
<li><a href="#基本语法">基本语法：</a></li>
<li><a href="#花式操作">花式操作</a>
<ul>
<li><a href="#查询并插入">查询并插入</a></li>
<li><a href="#查询并更新">查询并更新</a></li>
<li><a href="#查询并删除">查询并删除</a>
<ul>
<li><a href="#查找记录">查找记录</a></li>
<li><a href="#删除记录">删除记录</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
          </div>

        </div>

        <div class="btn-panel" id="btn-panel">
           
            <div class="btn-toc" id="btn-toc">
              <button class="btn" onclick="showToc()" title="文章目录" >
                <i class="fa fa-expand"></i>
              </button>
              <aside class="article-toc" id="panel-article-toc">
                <strong class="toc-title">文章目录</strong>
                <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#创建和删除">创建和删除</a></li>
<li><a href="#查看表">查看表</a></li>
<li><a href="#表字段">表字段</a>
<ul>
<li><a href="#常用字段属性">常用字段属性:</a></li>
<li><a href="#添加字段">添加字段</a></li>
<li><a href="#修改字段">修改字段</a></li>
<li><a href="#删除字段">删除字段</a></li>
<li><a href="#添加索引">添加索引</a></li>
<li><a href="#删除索引">删除索引</a></li>
</ul></li>
<li><a href="#insert语法">insert语法</a></li>
<li><a href="#update语法">update语法</a>
<ul>
<li><a href="#单条更新">单条更新：</a></li>
<li><a href="#多条更新">多条更新：</a></li>
</ul></li>
<li><a href="#delete语法">delete语法</a>
<ul>
<li><a href="#普通删除">普通删除：</a></li>
<li><a href="#多表删除">多表删除：</a></li>
<li><a href="#截断表">截断表：</a></li>
</ul></li>
<li><a href="#select语法">select语法</a>
<ul>
<li><a href="#基本语法">基本语法：</a></li>
<li><a href="#花式操作">花式操作</a>
<ul>
<li><a href="#查询并插入">查询并插入</a></li>
<li><a href="#查询并更新">查询并更新</a></li>
<li><a href="#查询并删除">查询并删除</a>
<ul>
<li><a href="#查找记录">查找记录</a></li>
<li><a href="#删除记录">删除记录</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
              </aside>
            </div>
            

            <div class="btn-share" id="btn-share">
              <button class="btn" title="分享">
                <i class="fa fa-share-alt"></i>
              </button>
            </div>
            <div class="btn-top" id="btn-top" >
              <button class="btn" onclick="backToTop()" title="返回顶部" >
                <i class="fa fa-arrow-up"></i>
              </button>
            </div>
        </div>
          <script src="https://lpgph.github.io/js/nav-scroll.js"></script>
          <script>
          $("#article-toc").navScrollSpy({
            navContainer: '#article-toc',
            current:"active",
            scrollSpeed: 50
          });

          $("#panel-article-toc").navScrollSpy({
            navContainer: '#panel-article-toc',
            current:"active",
            scrollSpeed: 50
          });


          
          </script>
      </div>
      <footer><div class="footer-background">
  <figure class="clouds"></figure>
  <figure class="background"></figure>
  <figure class="foreground"></figure>
</div>

<div class="footer" >
  <p class="copyright">
    Copyright © 2017-2019 <a href="https://lpgph.github.io/" title="Dreamcatcher">Dreamcatcher</a>
    &nbsp;&nbsp;|&nbsp;&nbsp;
    <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
  </p>
  <br/>
  <script>
      var now = new Date(); 
      function createtime() { 
          var grt= new Date("2017-01-07T00:00:00Z");
          now.setTime(now.getTime()+250); 
          days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
          hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
          if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
          mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
          seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
          snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
          document.getElementById("timeDate").innerHTML = "本站已勉强存活 "+dnum+" 天 "; 
          document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
      } 
      setInterval("createtime()",250);
  </script>

  <ul class="github-badge">
    <li>
      <a style="color: #fff" rel="license" href="https://hexo.io/" target="_blank" title="由 Hugo 强力驱动">
      <span class="badge-subject">Powered</span><span class="badge-value bg-blue">Hugo</span></a>
    </li>
    <li>
      <a style="color: #fff" rel="license" href="https://github.com/" target="_blank" title="静态网页托管于 GitHub Pages 和 Coding Pages">
      <span class="badge-subject">Hosted</span><span class="badge-value bg-brightgreen">GitHub &amp; Coding</span></a>
    </li>
    
    
    <li>
      <a style="color: #fff" rel="license" href="https://github.com/lpgph/hugo-theme-young" target="_blank" title="站点使用 hugo-theme-young 主题">
      <span class="badge-subject">Theme</span><span class="badge-value bg-blue">hugo-theme-young</span></a>
    </li>
    <li>
      <a style="color: #fff" rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" title="本站点采用知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议进行许可">
      <span class="badge-subject"><i class="fa fa-copyright"></i></span><span class="badge-value bg-lightgrey">BY-NC-SA 4.0</span></a>
    </li>
    <li>
      <a style="color: #fff" rel="license" href="https://996.icu/" target="_blank" title="支持 996.ICU">
      <span class="badge-subject">Link</span><span class="badge-value bg-red">996.ICU</span></a>
    </li>
    
    
  </ul>
</div>
</footer>
      



<script src="https://lpgph.github.io/js/main.js"></script>


<script type="text/javascript" color="220,220,220" opacity='1' zIndex="1" count="200" src="https://lpgph.github.io//js/canvas-nest.min.js"></script>
<script src="https://lpgph.github.io//js/piao.js" type="text/javascript"></script>
<script src="https://lpgph.github.io//js/circleMagic.js" type="text/javascript"></script>

<script>

document.addEventListener('DOMContentLoaded', (event) => {
  document.querySelectorAll('pre code').forEach((block) => {
    hljs.highlightBlock(block);
  });
});

$(function(){ 
  $('#app-header').circleMagic({
      radius: 20,
      density: 0.2,
      color: 'rgba(255,255,255, .2)',
      
      clearOffset: 0.3
  });

  
  $('#scroll-down').click(function () {
      backToTop();
  });
})

function backToTop() {
   let endScroll;
    endScroll = $('#app-header').height()+10,
    $('html,body').stop().animate({scrollTop: endScroll}, 1000);
}

function showToc() {
   var  btnToc = $("#btn-toc"), 
      
     tocIcon = $(".btn-toc .btn .fa");

    if(btnToc.hasClass("show")){
      btnToc.removeClass("show");
      tocIcon.removeClass("fa-expand");
      tocIcon.addClass("fa-compress");
    }else{
      btnToc.addClass('show');
      tocIcon.removeClass("fa-compress");
      tocIcon.addClass("fa-expand");
    }
}




var resizeTimer = null;
$(window).resize(function(){
  var homeScroll     = $('#app-header').height()-40,
      docScroll      = $(document).scrollTop(),
       articleToc     = $('#article-toc');

    if(resizeTimer){
        clearTimeout(resizeTimer);
    }
    resizeTimer = setTimeout(function(){
        var showToc = document.body.scrollWidth>1800;
        if (showToc) {
          $('#btn-toc').hide();
            if(homeScroll+50<=docScroll) {
              if (!articleToc.hasClass('fixed')) {
                  articleToc.addClass('fixed')
                  $(".article-toc-panel").addClass('fixed');
              }
            }
        }else{
          $('#btn-toc').show();
            if( homeScroll+50 >= docScroll) {
            if (articleToc.hasClass('fixed')) {
                articleToc.removeClass('fixed');
                $(".article-toc-panel").removeClass('fixed');
            } 
          }
        }

        if (document.body.scrollWidth<720) {
          $("#live2d-widget").css("opacity","0");
        }else{
          $("#live2d-widget").css("opacity","1");
        }

    },100)
})


var temScroll   = 0;

var scrollTimer = null;

  
  
$(window).scroll( function() { 

var homeScroll     = $('#app-header').height()-40,
    docScroll      = $(document).scrollTop();
    openButton     = $('#openaside'),
    navBtnTitle    = $('#nav-btn-title'),
    articleToc     = $('#article-toc');

    if(scrollTimer){
        clearTimeout(scrollTimer);
    }
    scrollTimer = setTimeout(function(){
          
      if (temScroll < docScroll) { 
        if (homeScroll <= docScroll) { 
            
            if (!openButton.hasClass('navbutton-scroll')) {
                openButton.addClass('navbutton-scroll');
                navBtnTitle.hide();
            }
        }
        var showToc = document.body.scrollWidth>1800;

        if (showToc)
          if(homeScroll+50<=docScroll) {
          if (!articleToc.hasClass('fixed')) {
              articleToc.addClass('fixed')
              $(".article-toc-panel").addClass('fixed');
          }
        }
        if (homeScroll+100<=docScroll) {
          if (!showToc) {
            $('#btn-toc').show();
          }
          $('#btn-share').show();
          $('#btn-top').show();
        }
      } else { 
        if (homeScroll >= docScroll) { 
          
          if (openButton.hasClass('navbutton-scroll')) {
            openButton.removeClass('navbutton-scroll');
            navBtnTitle.show();
          }
        }

        var showToc = document.body.scrollWidth > 1800;

        if (showToc){
          if( homeScroll+70 >= docScroll) {
            if (articleToc.hasClass('fixed')) {
                articleToc.removeClass('fixed');
                $(".article-toc-panel").removeClass('fixed');
            } 
          }
        }

        if (homeScroll+100>=docScroll) {
          if (!showToc) {
            $('#btn-toc').hide();
          }
          $('#btn-share').hide();
          $('#btn-top').hide();
        }

      }
      temScroll = docScroll;
    },100)

});
</script>

<script type="text/javascript">
done = false;
$(document).ready(function(){
  $('.navbar').click(function(){
    $('#app-header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('#closeaside'),
      o = $('#openaside');
      u = $("#sideBar")
  $(window).resize(function(){
    getSize();
    if (myWidth >= 1024) {
    
    }else
    {
      
      
      
    }
  });

  u.click(function(){
    $('.morph-shape').removeClass('show');
    a.removeClass('show-menu');
    u.css('display', 'none');
    o.css('display', 'block');
    $('body').css("overflow","auto");
  })
  c.click(function(){
    $('.morph-shape').removeClass('show');
    a.removeClass('show-menu');
    u.css('display', 'none');
    o.css('display', 'block');
    $('body').css("overflow","auto");
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.addClass('show-menu');
    $('.morph-shape').addClass('show');
    u.css('display', 'block');
    $('body').css("overflow","hidden");
    m.removeClass('moveMain');
  });
  

  $('form.search').on('submit', function (event) {
    if (false === done) {
      event.preventDefault();
      var orgVal = $(this).find('#search').val();
      $(this).find('#search').val('site:https:\/\/lpgph.github.io\/ ' + orgVal);
      done = true;
      $(this).submit();
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('#openaside'),
      c  = $('#closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
   
     
    
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://b.bshare.cn/barCode?site=weixin&url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});
</script>


<link rel="stylesheet" href="https://lpgph.github.io/plugin/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="https://lpgph.github.io/plugin/fancybox/jquery.fancybox.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
});
</script>




    </div>
  </div>
</body>
</html>